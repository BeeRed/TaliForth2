\ From: John Hayes S1I  ok
\ Subject: tester.fr  ok
\ Date: Mon, 27 Nov 95 13:10:09 PST    ok
  ok
\ Modified by SamCo 2018-05 for testing Tali Forth 2.  ok
\ The main change is lowercasing all of the words as Tali  ok
\ is case sensitive, as well as replacing tabs with spaces.  ok
\ A word to display the actual (erroneous) results was also added.  ok
  ok
\ (C) 1995 JOHNS HOPKINS UNIVERSITY / APPLIED PHYSICS LABORATORY  ok
\ MAY BE DISTRIBUTED FREELY AS LONG AS THIS COPYRIGHT NOTICE REMAINS.  ok
hex  ok
  ok
\ Set the following flag to true for more verbose output; this may allow you to  ok
\ tell which test caused your system to hang. With Tali Forth, this is useless  ok
\ because the Python script echoes all the output anyway.  ok
variable verbose  false verbose !  ok
  ok
variable actual-depth   \ stack record  ok
create actual-results  20 cells allot  ok
  ok
\ Empty stack: handles underflowed stack too  ok
: empty-stack ( ... -- )   compiled
   depth ?dup if   compiled
      dup 0< if   compiled
         negate 0 do 0 loop   compiled
      else   compiled
         0 do drop loop   compiled
      then   compiled
   then ;  ok
  ok
\ Print the previous test's actual results. Added by SamCo 2018-05   ok
: show-results ( -- )   compiled
   s"  ACTUAL RESULT: { " type  compiled
   actual-depth @ 0 ?do  compiled
      actual-results   compiled
      actual-depth @ i - 1- \ Print them in reverse order to match test.  compiled
      cells + @ .  compiled
   loop  compiled
   s" }" type ;  ok
  ok
\ Display an error message followed by the line that had the error  ok
: error  \ ( C-ADDR U -- )   compiled
   type source type \ display line corresponding to error  compiled
   empty-stack      \ throw away every thing else  compiled
   show-results ;   \ added by SamCo to show what actually happened  ok
  ok
\ Syntactic sugar  ok
: {  ( -- ) ;  ok
  ok
\ Record depth and content of stack  ok
: ->  ( ... -- )   compiled
   depth dup actual-depth !  \ record depth  compiled
   ?dup if                   \ if there is something on stack ...  compiled
      0 do   compiled
         actual-results i cells + !   compiled
      loop                   \ ... save it  compiled
   then ;  ok
  ok
\ Compare stack (expected) contents with saved (actual) contents  ok
: }  ( ... -- )   compiled
   depth actual-depth @ = if     \ if depths match  compiled
      depth ?dup if              \ if there is something on the stack  compiled
         0 do                    \ for each stack item  compiled
            actual-results i cells + @  \ compare actual with expected  compiled
            <> if   compiled
               s" INCORRECT RESULT: " error leave   compiled
            then  compiled
         loop  compiled
      then  compiled
   else                          \ depth mismatch  compiled
      s" WRONG NUMBER OF RESULTS: " error  compiled
   then ;  ok
  ok
\ Talking comment  ok
: testing ( -- )   compiled
   source verbose @ if   compiled
      dup >r type cr r> >in !  compiled
   else >in ! drop  compiled
   then ;  ok
\ ------------------------------------------------------------------------  ok
testing gforth words: bounds find-name latestxt name>int name>string  ok
  ok
\ Test for COLD not implemented  ok
  ok
( TODO BOUNDS test missing)  ok
( TODO FIND-NAME test missing)  ok
( TODO LATESTXT test missing)  ok
( TODO NAME>INT test missing)  ok
( TODO NAME>STRING test missing)  ok
  ok
  ok
\ ------------------------------------------------------------------------  ok
testing tali-only words: always-native bell compile-only digit? int>name latestnt number 0 1 2  ok
testing tali-only words: never-native wordsize  ok
decimal  ok
  ok
\ Repeat definitions for standalone testing  ok
0 constant 0s  ok
0 invert constant 1s  ok
0s constant <false>  ok
1s constant <true>  ok
  ok
\ Test for 0BRANCH not implemented  ok
\ Test for BRANCH not implemented  ok
\ Test for DISASM not implemented  ok
\ Test for INPUT not implemented  ok
\ Test for NC-LIMIT not implemented  ok
\ Test for OUTPUT not implemented  ok
\ Test for UF-STRIP not implemented  ok
  ok
( TODO ALWAY-NATIVE test missing)  ok
( TODO BELL test missing)  ok
( TODO COMPILE-ONLY test missing)  ok
( TODO INT>NAME test missing)  ok
( TODO LATESTNT test missing)  ok
( TODO NEVER-NATVE test missing)  ok
( TODO NUMBER test missing)  ok
( TODO WORDSIZE test missing)  ok
  ok
  ok
\ Nothing is too trivial for testing!  ok
{ 0 -> 0 }  ok
{ 1 -> 1 }  ok
{ 2 -> 2 }  ok
  ok
  ok
\ Test for DIGIT? ( char -- u f | char f )  ok
  ok
{ 36 constant max-base } \ ANSI standard says 2 - 36 WRONG NUMBER OF RESULTS: { 36 constant max-base } \ ANSI standard says 2 - 36 ACTUAL RESULT: { 2 } ok
{ base @  constant orig-base } WRONG NUMBER OF RESULTS: { base @  constant orig-base } ACTUAL RESULT: { 2 } ok
{ s" 0123456789" ( addr u ) drop  constant digit_numeral -> }  ok
{ s" abcdefghijklmnopqrstuvwxyz" ( addr u ) drop  constant digit_lower -> }  ok
{ s" ABCDEFGHIJKLMNOPQRSTUVWXYZ" ( addr u ) drop  constant digit_upper -> }  ok
  ok
\ "/" and ":" are before and after ASCII numbers  ok
\ "@" and "[" are before and after upper case ASCII letters  ok
\ "`" and "{" are before and after lower case ASCII letters  ok
{ s" /:@[`{"  ( addr u )  drop  constant digit_bad -> }  ok
  ok
: digit_numeral ( -- f )  compiled
   true  compiled
   base @  10 min  ( don't go outside chars )  0 ?do  compiled
      digit_numeral i +  ( addr ) c@   compiled
      dup emit       \ show user what's happening  compiled
      dup digit?  ( char  u | char  f )   compiled
      swap 48 ( ASCII "0" ) +   ( char  f  u | char )   compiled
      rot =  ( f f )       \ is number what it's supposed to be?  compiled
      and  ( f )           \ conversion was signaled as success?  compiled
      and                  \ merge with running tab flag  compiled
   loop ;   ok
  ok
: digit_letters ( -- f )   compiled
   true  compiled
   base @  10 - ( grow index with base)  0 ?do  compiled
      digit_lower i + c@    compiled
      dup emit  compiled
      dup digit?    compiled
      swap 97 ( ASCII "a" ) 10 -  +  compiled
      rot =   compiled
      and and   compiled
  compiled
      digit_upper i + c@    compiled
      dup emit  compiled
      dup digit?   compiled
      swap 65 ( ASCII "A" ) 10 -  +  compiled
      rot =   compiled
      and and   compiled
   loop ;   ok
  ok
: digit_oneoff ( -- f )   compiled
   true   compiled
   7 0 ?do  compiled
      digit_bad i + c@  compiled
      dup emit  compiled
      digit?  ( char 0 )   compiled
      nip invert   compiled
      and  compiled
   loop ;  ok
  ok
  ok
\ All your bases are belong to us. In theory, we could condense this  ok
\ code further, because Forth, but it would become harder to understand  ok
: digit_all ( -- f )  compiled
   true  compiled
  compiled
   max-base 1+  2 ?do  compiled
      decimal cr ." Numerals, base " i . ." : "   compiled
      i base !  compiled
      digit_numeral and  compiled
      dup ."  -> " .  \ print status of base to help find errors  compiled
   loop   compiled
     compiled
   decimal cr  compiled
   max-base 1+  11 ?do  compiled
      decimal cr ." Letters, base " i . ." : "   compiled
      i base !  compiled
      digit_letters and  compiled
      dup ."  -> " .  compiled
   loop   compiled
  compiled
   decimal cr  compiled
   max-base 1+ 2 ?do  compiled
      decimal cr ." One-off chars, base " i . ." : "   compiled
      i base !  compiled
      digit_oneoff and  compiled
      dup ."  -> " .   compiled
   loop ;  ok
  ok
{ digit_all -> <true> } 
Numerals, base 2 : 01 -> -1 
Numerals, base 3 : 012 -> -1 
Numerals, base 4 : 0123 -> -1 
Numerals, base 5 : 01234 -> -1 
Numerals, base 6 : 012345 -> -1 
Numerals, base 7 : 0123456 -> -1 
Numerals, base 8 : 01234567 -> -1 
Numerals, base 9 : 012345678 -> -1 
Numerals, base 10 : 0123456789 -> -1 
Numerals, base 11 : 0123456789 -> -1 
Numerals, base 12 : 0123456789 -> -1 
Numerals, base 13 : 0123456789 -> -1 
Numerals, base 14 : 0123456789 -> -1 
Numerals, base 15 : 0123456789 -> -1 
Numerals, base 16 : 0123456789 -> -1 
Numerals, base 17 : 0123456789 -> -1 
Numerals, base 18 : 0123456789 -> -1 
Numerals, base 19 : 0123456789 -> -1 
Numerals, base 20 : 0123456789 -> -1 
Numerals, base 21 : 0123456789 -> -1 
Numerals, base 22 : 0123456789 -> -1 
Numerals, base 23 : 0123456789 -> -1 
Numerals, base 24 : 0123456789 -> -1 
Numerals, base 25 : 0123456789 -> -1 
Numerals, base 26 : 0123456789 -> -1 
Numerals, base 27 : 0123456789 -> -1 
Numerals, base 28 : 0123456789 -> -1 
Numerals, base 29 : 0123456789 -> -1 
Numerals, base 30 : 0123456789 -> -1 
Numerals, base 31 : 0123456789 -> -1 
Numerals, base 32 : 0123456789 -> -1 
Numerals, base 33 : 0123456789 -> -1 
Numerals, base 34 : 0123456789 -> -1 
Numerals, base 35 : 0123456789 -> -1 
Numerals, base 36 : 0123456789 -> -1 

Letters, base 11 : aA -> -1 
Letters, base 12 : aAbB -> -1 
Letters, base 13 : aAbBcC -> -1 
Letters, base 14 : aAbBcCdD -> -1 
Letters, base 15 : aAbBcCdDeE -> -1 
Letters, base 16 : aAbBcCdDeEfF -> -1 
Letters, base 17 : aAbBcCdDeEfFgG -> -1 
Letters, base 18 : aAbBcCdDeEfFgGhH -> -1 
Letters, base 19 : aAbBcCdDeEfFgGhHiI -> -1 
Letters, base 20 : aAbBcCdDeEfFgGhHiIjJ -> -1 
Letters, base 21 : aAbBcCdDeEfFgGhHiIjJkK -> -1 
Letters, base 22 : aAbBcCdDeEfFgGhHiIjJkKlL -> -1 
Letters, base 23 : aAbBcCdDeEfFgGhHiIjJkKlLmM -> -1 
Letters, base 24 : aAbBcCdDeEfFgGhHiIjJkKlLmMnN -> -1 
Letters, base 25 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoO -> -1 
Letters, base 26 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpP -> -1 
Letters, base 27 : aAb
{ digit_all -> <true> } 
Numerals, base 2 : 01 -> -1 
Numerals, base 3 : 012 -> -1 
Numerals, base 4 : 0123 -> -1 
Numerals, base 5 : 01234 -> -1 
Numerals, base 6 : 012345 -> -1 
Numerals, base 7 : 0123456 -> -1 
Numerals, base 8 : 01234567 -> -1 
Numerals, base 9 : 012345678 -> -1 
Numerals, base 10 : 0123456789 -> -1 
Numerals, base 11 : 0123456789 -> -1 
Numerals, base 12 : 0123456789 -> -1 
Numerals, base 13 : 0123456789 -> -1 
Numerals, base 14 : 0123456789 -> -1 
Numerals, base 15 : 0123456789 -> -1 
Numerals, base 16 : 0123456789 -> -1 
Numerals, base 17 : 0123456789 -> -1 
Numerals, base 18 : 0123456789 -> -1 
Numerals, base 19 : 0123456789 -> -1 
Numerals, base 20 : 0123456789 -> -1 
Numerals, base 21 : 0123456789 -> -1 
Numerals, base 22 : 0123456789 -> -1 
Numerals, base 23 : 0123456789 -> -1 
Numerals, base 24 : 0123456789 -> -1 
Numerals, base 25 : 0123456789 -> -1 
Numerals, base 26 : 0123456789 -> -1 
Numerals, base 27 : 0123456789 -> -1 
Numerals, base 28 : 0123456789 -> -1 
Numerals, base 29 : 0123456789 -> -1 
Numerals, base 30 : 0123456789 -> -1 
Numerals, base 31 : 0123456789 -> -1 
Numerals, base 32 : 0123456789 -> -1 
Numerals, base 33 : 0123456789 -> -1 
Numerals, base 34 : 0123456789 -> -1 
Numerals, base 35 : 0123456789 -> -1 
Numerals, base 36 : 0123456789 -> -1 

Letters, base 11 : aA -> -1 
Letters, base 12 : aAbB -> -1 
Letters, base 13 : aAbBcC -> -1 
Letters, base 14 : aAbBcCdD -> -1 
Letters, base 15 : aAbBcCdDeE -> -1 
Letters, base 16 : aAbBcCdDeEfF -> -1 
Letters, base 17 : aAbBcCdDeEfFgG -> -1 
Letters, base 18 : aAbBcCdDeEfFgGhH -> -1 
Letters, base 19 : aAbBcCdDeEfFgGhHiI -> -1 
Letters, base 20 : aAbBcCdDeEfFgGhHiIjJ -> -1 
Letters, base 21 : aAbBcCdDeEfFgGhHiIjJkK -> -1 
Letters, base 22 : aAbBcCdDeEfFgGhHiIjJkKlL -> -1 
Letters, base 23 : aAbBcCdDeEfFgGhHiIjJkKlLmM -> -1 
Letters, base 24 : aAbBcCdDeEfFgGhHiIjJkKlLmMnN -> -1 
Letters, base 25 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoO -> -1 
Letters, base 26 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpP -> -1 
Letters, base 27 : aAbBcCdD
eEfFgGhHiIjJkKlLmMnNoOpPqQ -> -1 
Letters, base 28 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrR -> -1 
Letters, base 29 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsS -> -1 
Letters, base 30 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStT -> -1 
Letters, base 31 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuU -> -1 
Letters, base 32 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvV -> -1 
Letters, base 33 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwW -> -1 
Letters, base 34 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxX -> -1 
Letters, base 35 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyY -> -1 
Letters, base 36 : aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ -> -1 

One-off chars, base 2 : /:@[`{	 -> -1 
One-off chars, base 3 : /:@[`{	 -> -1 
One-off chars, base 4 : /:@[`{	 -> -1 
One-off chars, base 5 : /:@[`{	 -> -1 
One-off chars, base 6 : /:@[`{	 -> -1 
One-off chars, base 7 : /:@[`{	 -> -1 
One-off chars, base 8 : /:@[`{	 -> -1 
One-off chars, base 9 : /:@[`{	 -> -1 
One-off chars, base 10 : /:@[`{	 -> -1 
One-off chars, base 11 : /:@[`{	 -> -1 
One-off chars, base 12 : /:@[`{	 -> -1 
One-off chars, base 13 : /:@[`{	 -> -1 
One-off chars, base 14 : /:@[`{	 -> -1 
One-off chars, base 15 : /:@[`{	 -> -1 
One-off chars, base 16 : /:@[`{	 -> -1 
One-off chars, base 17 : /:@[`{	 -> -1 
One-off chars, base 18 : /:@[`{	 -> -1 
One-off chars, base 19 : /:@[`{	 -> -1 
One-off chars, base 20 : /:@[`{	 -> -1 
One-off chars, base 21 : /:@[`{	 -> -1 
One-off chars, base 22 : /:@[`{	 -> -1 
One-off chars, base 23 : /:@[`{	 -> -1 
One-off chars, base 24 : /:@[`{	 -> -1 
One-off chars, base 25 : /:@[`{	 -> -1 
One-off chars, base 26 : /:@[`{	 -> -1 
One-off chars, base 27 : /:@[`{	 -> -1 
One-off chars, base 28 : /:@[`{	 -> -1 
One-off chars, base 29 : /:@[`{	 -> -1 
One-off chars, base 30 : /:@[`{	 -> -1 
One-off chars, base 31 : /:@[`{	 -> -1 
One-off chars, base 32 : /:@[`{	 -> -1 
One-off chars, base 33 : /:@[`{	 -> -1 
One-off chars, base 34 : /:@[`{	 -> -1 
One-off chars, base 35 : /:@[`{	 -> -1 
One-off chars, base 36 : /:@[`{	 -> -1  ok
  ok
